---
import type { Wedding } from '../lib/types';
import '../styles/global.css';

interface Props {
  wedding: Wedding;
  title?: string;
  showNav?: boolean;
}

const { wedding, title, showNav = true } = Astro.props;
const { config } = wedding;
const pageTitle = title ? `${title} - ${wedding.name}` : wedding.name;

// Use custom theme colors if defined
const primaryColor = config.theme.primaryColor || '#ae1725';
const secondaryColor = config.theme.secondaryColor || '#c92a38';
---

<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={`Site de mariage de ${config.brideName} & ${config.groomName}`} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{pageTitle}</title>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content={primaryColor} />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />

    <!-- Custom theme colors -->
    <style define:vars={{ primaryColor, secondaryColor }}>
      :root {
        --wedding-primary: var(--primaryColor);
        --wedding-secondary: var(--secondaryColor);
      }
    </style>
  </head>
  <body class="bg-pearl-white text-deep-charcoal font-sans antialiased min-h-screen">
    <!-- Wedding Navigation -->
    {showNav && (
      <header class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-md border-b border-charcoal/5 shadow-xs">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div class="flex items-center justify-between">
            <!-- Logo / Names with script font -->
            <a
              href={`/${wedding.slug}`}
              class="font-script text-2xl sm:text-3xl transition-opacity hover:opacity-80"
              style={`color: ${primaryColor}`}
            >
              {config.brideName} <span class="font-serif text-lg opacity-50">&</span> {config.groomName}
            </a>

            <!-- Navigation Links -->
            <ul class="hidden md:flex items-center gap-1">
              <li>
                <a
                  href={`/${wedding.slug}`}
                  class="px-4 py-2 text-sm font-medium text-charcoal/70 hover:text-charcoal transition-colors tracking-wide"
                >
                  Site Web
                </a>
              </li>
              {config.features.photoGallery && (
                <li>
                  <a
                    href={`/${wedding.slug}/photos`}
                    class="px-4 py-2 text-sm font-medium text-charcoal/70 hover:text-charcoal transition-colors tracking-wide"
                  >
                    Photos
                  </a>
                </li>
              )}
              {config.features.guestbook && (
                <li>
                  <a
                    href={`/${wedding.slug}/livre-or`}
                    class="px-4 py-2 text-sm font-medium text-charcoal/70 hover:text-charcoal transition-colors tracking-wide"
                  >
                    Livre d'or
                  </a>
                </li>
              )}
              {config.timeline && config.timeline.length > 0 && (
                <li>
                  <a
                    href={`/${wedding.slug}/infos`}
                    class="px-4 py-2 text-sm font-medium text-charcoal/70 hover:text-charcoal transition-colors tracking-wide"
                  >
                    Infos
                  </a>
                </li>
              )}
              {config.features.rsvp && (
                <li class="ml-2">
                  <a
                    href={`/${wedding.slug}/rsvp`}
                    class="px-6 py-2.5 text-sm text-white font-medium transition-all hover:opacity-90 tracking-wide uppercase"
                    style={`background-color: ${primaryColor}`}
                  >
                    RSVP
                  </a>
                </li>
              )}
            </ul>

            <!-- Mobile menu button -->
            <button
              id="mobile-menu-btn"
              class="md:hidden w-10 h-10 flex items-center justify-center text-charcoal/70 hover:text-charcoal transition-colors"
              aria-label="Menu"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
          </div>

          <!-- Mobile menu -->
          <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 border-t border-charcoal/10 pt-4">
            <ul class="flex flex-col gap-1">
              <li>
                <a href={`/${wedding.slug}`} class="block py-3 px-2 text-charcoal/70 hover:text-charcoal hover:bg-cream/50 transition-colors font-medium">
                  Site Web
                </a>
              </li>
              {config.features.photoGallery && (
                <li>
                  <a href={`/${wedding.slug}/photos`} class="block py-3 px-2 text-charcoal/70 hover:text-charcoal hover:bg-cream/50 transition-colors font-medium">
                    Photos
                  </a>
                </li>
              )}
              {config.features.guestbook && (
                <li>
                  <a href={`/${wedding.slug}/livre-or`} class="block py-3 px-2 text-charcoal/70 hover:text-charcoal hover:bg-cream/50 transition-colors font-medium">
                    Livre d'or
                  </a>
                </li>
              )}
              {config.timeline && config.timeline.length > 0 && (
                <li>
                  <a href={`/${wedding.slug}/infos`} class="block py-3 px-2 text-charcoal/70 hover:text-charcoal hover:bg-cream/50 transition-colors font-medium">
                    Infos pratiques
                  </a>
                </li>
              )}
              {config.features.rsvp && (
                <li class="mt-3">
                  <a
                    href={`/${wedding.slug}/rsvp`}
                    class="block text-center px-4 py-3 text-white font-medium tracking-wide uppercase"
                    style={`background-color: ${primaryColor}`}
                  >
                    Confirmer ma présence
                  </a>
                </li>
              )}
            </ul>
          </div>
        </nav>
      </header>
    )}

    <!-- Main Content -->
    <main class={showNav ? "pt-[72px]" : ""}>
      <slot />
    </main>

    <!-- Elegant Footer -->
    <footer class="bg-linear-to-b from-cream to-cream-dark py-12 border-t border-charcoal/5">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Decorative top element -->
        <div class="flex items-center justify-center gap-4 mb-8">
          <div class="w-16 h-px bg-linear-to-r from-transparent" style={`--tw-gradient-to: ${primaryColor}30`}></div>
          <span class="text-2xl" style={`color: ${primaryColor}40`}>❦</span>
          <div class="w-16 h-px bg-linear-to-l from-transparent" style={`--tw-gradient-to: ${primaryColor}30`}></div>
        </div>

        <!-- Names -->
        <p class="text-center font-script text-3xl mb-3" style={`color: ${primaryColor}`}>
          {config.brideName} & {config.groomName}
        </p>

        <!-- Date -->
        <p class="text-center text-charcoal/60 font-light mb-6">
          {new Date(config.weddingDate).toLocaleDateString('fr-FR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}
        </p>

        <!-- Quote -->
        <p class="text-center text-charcoal/40 font-serif italic text-sm max-w-md mx-auto mb-8">
          "L'amour ne se voit pas avec les yeux, mais avec le cœur"
        </p>

        <!-- Powered by -->
        <div class="text-center pt-6 border-t border-charcoal/5">
          <p class="text-xs text-charcoal/40 font-light">
            Propulsé par{' '}
            <a
              href="/"
              class="hover:underline transition-colors"
              style={`color: ${primaryColor}`}
            >
              Reflets de Bonheur
            </a>
          </p>
        </div>
      </div>
    </footer>

    <!-- Mobile menu script -->
    <script>
      const menuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');

      if (menuBtn && mobileMenu) {
        menuBtn.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
        });
      }
    </script>
  </body>
</html>
