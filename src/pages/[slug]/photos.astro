---
// Enable SSR for dynamic slugs
export const prerender = false;

import WeddingLayout from '../../layouts/WeddingLayout.astro';
import WeddingLuxeLayout from '../../layouts/WeddingLuxeLayout.astro';
import { GalleryGrid } from '../../components/gallery/GalleryGrid';
import { LuxeNav } from '../../components/wedding/LuxeNav';
import { getWeddingBySlugAsync } from '../../lib/weddingData';
import { getTheme } from '../../lib/themes';

const { slug } = Astro.params;
const wedding = await getWeddingBySlugAsync(slug as string);

if (!wedding) {
  return Astro.redirect('/404');
}

const { config } = wedding;
const themeId = config.theme.id || 'classic';
const theme = getTheme(themeId);
const isLuxe = themeId === 'luxe';

// In production, this would be the real wedding ID from Supabase
const weddingId = wedding.id;

const weddingDate = new Date(config.weddingDate).toLocaleDateString('fr-FR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

{isLuxe ? (
  <!-- LUXE THEME -->
  <WeddingLuxeLayout wedding={wedding} title="Photos" currentPage="photos">
    <section class="pt-6 pb-4 px-5">
      <h1 class="text-2xl font-display text-center" style={`color: ${theme.colors.text}; font-family: 'Playfair Display', serif;`}>
        Galerie Photos
      </h1>
      <p class="text-center text-sm mt-2" style={`color: ${theme.colors.textLight}`}>
        Partagez vos souvenirs avec {config.brideName} & {config.groomName}
      </p>
    </section>

    <section class="px-4 pb-24">
      <GalleryGrid
        weddingId={weddingId}
        client:load
        variant="public"
      />
    </section>

    <LuxeNav slug={wedding.slug} currentPage="photos" client:load />
  </WeddingLuxeLayout>
) : (
  <!-- CLASSIC THEME -->
  <WeddingLayout wedding={wedding} title="Photos" showNav={false} showFooter={false}>
    <section class="min-h-screen bg-gradient-to-b from-[#f7f2f5] via-[#f8f4f8] to-[#efe9f0]">
      <div class="w-full px-4 sm:px-6 lg:px-10 pt-8 pb-16">
        <!-- Mobile Header -->
        <div class="flex items-center justify-between md:hidden text-charcoal/60">
          <button class="w-10 h-10 flex items-center justify-center rounded-full bg-white/70 border border-charcoal/10">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <span class="font-serif text-base text-charcoal">{config.brideName} & {config.groomName}</span>
          <div class="w-10 h-10 rounded-full bg-white/70 border border-charcoal/10 flex items-center justify-center text-xs text-charcoal/50">
            {config.brideName?.[0]}{config.groomName?.[0]}
          </div>
        </div>

        <!-- Desktop Header -->
        <div class="hidden md:block text-center">
          <h1 class="font-serif text-4xl lg:text-5xl text-charcoal tracking-wide">
            {config.brideName} & {config.groomName}
          </h1>
          <nav class="mt-5 flex items-center justify-center gap-6 text-xs uppercase tracking-[0.3em] text-charcoal/60">
            <a href={`/${wedding.slug}`} class="hover:text-charcoal transition-colors">
              Accueil
            </a>
            {config.features.photoGallery && (
              <a href={`/${wedding.slug}/photos`} class="text-charcoal border-b border-charcoal pb-1">
                Galerie
              </a>
            )}
            {config.features.guestbook && (
              <a href={`/${wedding.slug}/livre-or`} class="hover:text-charcoal transition-colors">
                Livre d'or
              </a>
            )}
            {config.features.rsvp && (
              <a href={`/${wedding.slug}/rsvp`} class="hover:text-charcoal transition-colors">
                RSVP
              </a>
            )}
          </nav>
        </div>

        <div class="mt-8 border-t border-charcoal/10"></div>

        <div class="text-center mt-6">
          <p class="text-xs uppercase tracking-[0.35em] text-charcoal/50">Moments inoubliables</p>
          <p class="text-sm text-charcoal/50 mt-2">
            Galerie de mariage Â· {weddingDate}
          </p>
        </div>

        <!-- Gallery -->
        <div class="mt-10">
          <GalleryGrid
            weddingId={weddingId}
            client:load
            variant="public"
          />
        </div>
      </div>
    </section>
  </WeddingLayout>
)}
