---
// Enable SSR for dynamic slugs
export const prerender = false;

import WeddingLayout from '../../layouts/WeddingLayout.astro';
import WeddingLuxeLayout from '../../layouts/WeddingLuxeLayout.astro';
import { WeddingRSVP } from '../../components/wedding/WeddingRSVP';
import { LuxeNav } from '../../components/wedding/LuxeNav';
import { getWeddingBySlugAsync } from '../../lib/weddingData';
import { getTheme } from '../../lib/themes';

const { slug } = Astro.params;
const wedding = await getWeddingBySlugAsync(slug as string);

if (!wedding) {
  return Astro.redirect('/404');
}

const { config } = wedding;
const themeId = config.theme.id || 'classic';
const theme = getTheme(themeId);
const isLuxe = themeId === 'luxe';
const primaryColor = config.theme.primaryColor || '#ae1725';
---

{isLuxe ? (
  <!-- LUXE THEME -->
  <WeddingLuxeLayout wedding={wedding} title="RSVP" currentPage="home">
    <section class="pt-6 pb-4 px-5">
      <h1 class="text-2xl font-display text-center" style={`color: ${theme.colors.text}; font-family: 'Playfair Display', serif;`}>
        Confirmez votre pr√©sence
      </h1>
      <p class="text-center text-sm mt-2" style={`color: ${theme.colors.textLight}`}>
        {config.brideName} & {config.groomName} seraient ravis de vous compter parmi eux
      </p>
    </section>

    <section class="px-4 pb-24">
      <div class="bg-white/80 backdrop-blur-xs rounded-2xl p-5 border" style={`border-color: ${theme.colors.border}`}>
        <WeddingRSVP weddingId={wedding.id} config={config} client:load />
      </div>
    </section>

    <LuxeNav slug={wedding.slug} currentPage="home" client:load />
  </WeddingLuxeLayout>
) : (
  <!-- CLASSIC THEME -->
  <WeddingLayout wedding={wedding} title="RSVP" showNav={false} showFooter={false}>
    <section class="min-h-screen bg-[#e9e6ea] flex items-center justify-center px-4 py-10">
      <div class="w-full max-w-md bg-white rounded-[28px] shadow-2xl overflow-hidden">
        <div class="h-1" style={`background-color: ${primaryColor}`}></div>
        <div class="p-8 sm:p-10">
          <WeddingRSVP weddingId={wedding.id} config={config} client:load />
        </div>
      </div>
    </section>
  </WeddingLayout>
)}
